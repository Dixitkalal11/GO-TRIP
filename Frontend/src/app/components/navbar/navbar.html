<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm" [class.scrolled]="scrolled">
  <div class="container">
    <!-- Brand / Logo -->
    <a class="navbar-brand d-flex align-items-center" routerLink="">
      <img src="assets/images/GoTrip Logo.png" alt="GoTrip Logo" height="40" class="me-2">
      <span class="fw-bold text-dark fs-4">GoTrip</span>
    </a>

    <!-- Toggle button (mobile) -->
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Menu items -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto align-items-lg-center">

        <li class="nav-item">
          <a class="nav-link" routerLink="" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="booking" routerLinkActive="active">Booking</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="packages" routerLinkActive="active">Packages</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="contact" routerLinkActive="active">Contact</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-nowrap" routerLink="my-bookings" routerLinkActive="active">My Bookings</a>
        </li>

        <!-- Search box (compact) -->
        <li class="nav-item ms-lg-3 search-container">
          <div class="search-wrapper">
            <form (ngSubmit)="onSearchSubmit($event)" class="d-flex">
          <div class="input-group input-group-sm search-group">
            <span class="input-group-text bg-transparent border-0 px-2">
              <i class="bi bi-search text-muted"></i>
            </span>
                <input 
                  type="text" 
                  class="form-control search-box" 
                  placeholder="Search trips, cities, pages..." 
                  [(ngModel)]="searchQuery"
                  (input)="onSearchInput($event)"
                  (focus)="onSearchInput($event)"
                  name="searchQuery"
                  autocomplete="off"
                />
              </div>
            </form>
            
            <!-- Search Results Dropdown -->
            <div class="search-results-dropdown" *ngIf="showSearchResults" (click)="$event.stopPropagation()">
              <div *ngIf="searchResults.length > 0">
                <div 
                  class="search-result-item" 
                  *ngFor="let result of searchResults"
                  (click)="result.action ? result.action() : navigateToPage(result.route)"
                >
                  <div class="result-content">
                    <div class="result-display">{{ result.display }}</div>
                    <div class="result-type">{{ result.type === 'city' ? 'City' : 'Page' }}</div>
                  </div>
                </div>
              </div>
              <div class="search-footer" *ngIf="displayQuery && displayQuery.trim().length > 0">
                <small class="text-muted">Press Enter to search for "{{ displayQuery }}"</small>
              </div>
            </div>
          </div>
        </li>

        <!-- Show when logged in -->
        <ng-container *ngIf="isLoggedIn; else loggedOut">
          <li class="nav-item dropdown ms-lg-3 user-chip-wrap">
            <button class="user-chip dropdown-toggle rounded-pill d-flex align-items-center px-3 py-1 gap-2" data-bs-toggle="dropdown" aria-expanded="false">
              <div class="user-avatar" [style.backgroundImage]="profilePhotoUrl ? 'url(' + profilePhotoUrl + ')' : ''">
                <span *ngIf="!profilePhotoUrl">{{ (userName || 'U') | slice:0:1 | uppercase }}</span>
              </div>
              <span class="user-name text-truncate">{{ userName }}</span>
              <span class="coins-badge"><i class="bi bi-coin"></i> {{ userCoins }} <span class="ms-1">Coins</span></span>
              <i class="bi bi-caret-down-fill caret-icon"></i>
            </button>

            <ul class="dropdown-menu dropdown-menu-end p-2 user-menu">
              <li class="px-2 pb-2 small text-muted">Signed in as <span class="fw-semibold">{{ userName }}</span></li>
              <li><a class="dropdown-item d-flex align-items-center" routerLink="profile"><i class="bi bi-person-gear me-2"></i>Profile</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><button class="dropdown-item d-flex align-items-center text-danger" (click)="logout()"><i class="bi bi-box-arrow-right me-2"></i>Logout</button></li>
            </ul>
          </li>
        </ng-container>

        <!-- Show when logged out -->
        <ng-template #loggedOut>
          <li class="nav-item ms-lg-3">
            <div class="auth-actions d-flex align-items-center gap-2">
              <a class="btn btn-sm px-3 btn-login" routerLink="login" routerLinkActive="active"><i class="bi bi-box-arrow-in-right me-1"></i>Login</a>
              <a class="btn btn-sm px-3 btn-register" routerLink="register" routerLinkActive="active"><i class="bi bi-person-plus me-1"></i>Register</a>
            </div>
          </li>
        </ng-template>

      </ul>
    </div>
  </div>
</nav>
