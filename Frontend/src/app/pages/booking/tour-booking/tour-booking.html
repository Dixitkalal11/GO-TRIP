<div class="tour-booking-container" *ngIf="selectedTour">
  <div class="container">
    <!-- Tour Details Card -->
    <div class="trip-details-card">
      <div class="card-header">
        <i class="bi bi-camera"></i>
        <h3>Tour Package Details</h3>
      </div>
      <div class="trip-info">
        <div class="info-item">
          <span class="label">Tour Name</span>
          <span class="value">{{ selectedTour.title }}</span>
        </div>
        <div class="info-item">
          <span class="label">Location</span>
          <span class="value">{{ selectedTour.fromCity }} ‚Üí {{ selectedTour.toCity }}</span>
        </div>
        <div class="info-item">
          <span class="label">Tour Date</span>
          <span class="value">{{ travelDate }}</span>
        </div>
        <div class="info-item">
          <span class="label">Duration</span>
          <span class="value">{{ selectedTour.duration }}</span>
        </div>
        <div class="info-item">
          <span class="label">Operator</span>
          <span class="value">{{ selectedTour.operator }}</span>
        </div>
        <div class="info-item">
          <span class="label">Price per person</span>
          <span class="value price-value">‚Çπ{{ selectedTour.price }}</span>
          <span class="coins-badge">+{{ getTotalCoins() }} coins</span>
        </div>
        <div class="info-item" *ngIf="selectedTour.amenities && selectedTour.amenities.length > 0">
          <span class="label">Included</span>
          <span class="value">{{ selectedTour.amenities.join(', ') }}</span>
        </div>
      </div>
    </div>

    <!-- Discount Selection -->
    <div class="discount-section" *ngIf="discountConfigs.length > 0">
      <h4>Select Discount Type</h4>
      <div class="discount-options">
        <div 
          *ngFor="let config of discountConfigs" 
          class="discount-card"
          [class.active]="selectedDiscountType === config.type"
          (click)="selectedDiscountType = config.type; discountCoinsService.selectDiscountType(config.type)">
          <div class="discount-header">
            <h5>{{ config.name }}</h5>
            <span class="discount-badge" *ngIf="config.discountPercentage > 0">{{ config.discountPercentage }}% OFF</span>
          </div>
          <div class="discount-details">
            <p>{{ config.description }}</p>
            <div class="coins-info" *ngIf="config.baseCoinsEarned > 0">
              <i class="bi bi-coin"></i>
              <span>+{{ getCurrentCoinsForConfig(config) }} coins</span>
            </div>
            <div class="bonus-info" *ngIf="userBookingStats.totalBookings < 3">
              <i class="bi bi-gift"></i>
              <span>First 3 bookings: +5 bonus!</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Primary Contact Details Section -->
    <div class="contact-details-section">
      <div class="section-header">
        <div class="header-left">
          <i class="bi bi-telephone-fill"></i>
          <h3>üìû Primary Contact Details</h3>
          <span class="section-subtitle">(Only once per booking)</span>
        </div>
      </div>
      <div class="contact-form">
        <form #contactForm="ngForm">
          <div class="form-row">
            <div class="form-group">
              <label>Mobile Number<span class="required-asterisk">*</span></label>
              <div class="input-group">
                <i class="bi bi-phone"></i>
                <input 
                  type="tel" 
                  name="mobileNumber"
                  [(ngModel)]="bookingContact.mobileNumber" 
                  placeholder="Enter mobile number"
                  required
                  pattern="[0-9]{10}"
                  #mobileNumber="ngModel"
                  (blur)="onMobileBlur()">
              </div>
              <app-form-error [control]="mobileNumber.control" fieldName="Mobile number"></app-form-error>
            </div>
            <div class="form-group">
              <label>Email ID<span class="required-asterisk">*</span></label>
              <div class="input-group">
                <i class="bi bi-envelope"></i>
                <input 
                  type="email" 
                  name="emailId"
                  [(ngModel)]="bookingContact.emailId" 
                  placeholder="Enter email address"
                  required
                  email
                  #emailId="ngModel"
                  (blur)="onEmailBlur()">
              </div>
              <app-form-error [control]="emailId.control" fieldName="Email"></app-form-error>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Passenger Details Section -->
    <div class="passenger-details-section">
      <div class="section-header">
        <div class="header-left">
          <i class="bi bi-people-fill"></i>
          <h3>üßç‚Äç‚ôÇÔ∏è Passenger Details</h3>
          <span class="section-subtitle">({{ passengers.length }} passenger{{ passengers.length > 1 ? 's' : '' }})</span>
        </div>
        <button class="add-passenger-btn" (click)="addPassenger()" *ngIf="passengers.length < 10">
          <i class="bi bi-plus"></i> Add Passenger
        </button>
      </div>

      <div class="passenger-forms">
        <div class="passenger-form" *ngFor="let passenger of passengers; let i = index">
          <div class="passenger-header">
            <h4>Passenger {{ i + 1 }}</h4>
            <button class="remove-passenger-btn" (click)="removePassenger(i)" *ngIf="passengers.length > 1">
              <i class="bi bi-trash"></i>
            </button>
          </div>

          <div class="form-section">
            <h5 class="section-title">Required Information</h5>
            <div class="form-row">
              <div class="form-group">
                <label>Full Name<span class="required-asterisk">*</span></label>
                <div class="input-group">
                  <i class="bi bi-person"></i>
                  <input 
                    type="text" 
                    name="fullName{{i}}"
                    [(ngModel)]="passenger.fullName" 
                    placeholder="As per ID proof"
                    required
                    #fullName="ngModel"
                    (blur)="passenger.fullName = validationService.removeExtraSpaces(passenger.fullName)">
                </div>
                <app-form-error [control]="fullName.control" fieldName="Full name"></app-form-error>
              </div>
              <div class="form-group">
                <label>Age<span class="required-asterisk">*</span></label>
                <div class="input-group">
                  <i class="bi bi-calendar"></i>
                  <input 
                    type="number" 
                    name="age{{i}}"
                    [(ngModel)]="passenger.age" 
                    placeholder="Age" 
                    min="1" 
                    max="120"
                    required
                    #age="ngModel">
                </div>
                <app-form-error [control]="age.control" fieldName="Age"></app-form-error>
              </div>
              <div class="form-group">
                <label>Gender<span class="required-asterisk">*</span></label>
                <div class="input-group">
                  <i class="bi bi-gender-ambiguous"></i>
                  <select 
                    name="gender{{i}}"
                    [(ngModel)]="passenger.gender"
                    required
                    #gender="ngModel">
                    <option value="">Select Gender</option>
                    <option *ngFor="let genderOption of genderOptions" [value]="genderOption">{{ genderOption }}</option>
                  </select>
                </div>
                <app-form-error [control]="gender.control" fieldName="Gender"></app-form-error>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>ID Proof Type <span class="required">*</span></label>
                <div class="input-group">
                  <i class="bi bi-card-text"></i>
                  <select [(ngModel)]="passenger.idProofType">
                    <option value="">Select ID Proof</option>
                    <option *ngFor="let idType of idProofTypes" [value]="idType">{{ idType }}</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label>ID Proof Number <span class="required">*</span></label>
                <div class="input-group">
                  <i class="bi bi-hash"></i>
                  <input type="text" [(ngModel)]="passenger.idProofNumber" placeholder="Enter ID proof number">
                </div>
              </div>
              <div class="form-group">
                <label>Emergency Contact <span class="required">*</span></label>
                <div class="input-group">
                  <i class="bi bi-telephone"></i>
                  <input type="tel" [(ngModel)]="passenger.emergencyContact" placeholder="Emergency contact number">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Payment Summary -->
    <div class="payment-summary-card">
      <div class="summary-left">
        <div class="total-amount">
          <span class="total-label">Total: ‚Çπ{{ getTotalPrice() }}</span>
          <span class="coins-earned">Earn {{ getTotalCoins() }} coins</span>
        </div>
        <div class="passenger-info">
          For {{ passengers.length }} passenger{{ passengers.length > 1 ? 's' : '' }} ‚Ä¢ {{ selectedTour.duration }} Tour
        </div>
      </div>
      <button class="proceed-payment-btn" (click)="proceedToPayment()">
        Proceed to Payment
      </button>
    </div>
  </div>
</div>

